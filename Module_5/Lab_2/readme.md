Написать модуль ядра для своей версии ядра, который будет обмениваться информацией с userspace через proc. Адаптировать для своей версии ядра (Структура обработчиков). Избавиться от харкода (маг чисел) и изолировать переменные модуля (static).